<ion-header>
  <ion-toolbar>
    <ion-title>Darshan</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refresh()">
        <ion-icon slot="icon-only" name="refresh"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content no-padding>
  <div class="spinner" *ngIf="isLoading">
    <span class="helper"></span>
    <ion-spinner name="crescent"></ion-spinner>
  </div>
  <!-- <ion-list *ngIf="isLoading">
    <ion-item no-margin no-padding lines="none" *ngFor="let image of darshan">
      <ion-card class="darshan-card">
        <div class="placeholder"></div>
      </ion-card>
    </ion-item>
  </ion-list> -->
  <!-- <ion-item-group *ngIf="!isLoading">
      <ion-item-divider color="light"></ion-item-divider>
      <ion-item>
        <ion-label>date</ion-label>
      </ion-item>
  </ion-item-group> -->
  <ion-list *ngIf="!isLoading">
    <ion-item lines="none">
      <ion-label text-right class='date'>{{date | date: 'mediumDate'}}</ion-label>
    </ion-item>
    <ion-item no-margin no-padding lines="none" *ngFor="let image of darshan; let i = index">
      <ion-card class="darshan-card">


        <!-- <ion-img (ionImgDidLoad)="image.isLoaded = true" (click)="presentModal(darshan, i)"
          [src]="normalizeURL(image?.fileName)"></ion-img> -->

        <!-- <ion-img (ionImgDidLoad)="image.isLoaded = true" (click)="presentModal(darshan, i)" [src]="image?.url">
        </ion-img> -->

        <!-- <img [hidden]="!image?.isLoaded" (load)="image.isLoaded = true" [src]="image?.url"> -->
        <!-- <ion-img class="darshan-image" [src]="image?.placeholder" alt=""></ion-img> -->

        <ion-img [hidden]="!(image?.isDownloaded | async) || !image?.isLoaded" class="darshan-image" [src]="normalizeURL(image?.fileName)" (click)="presentModal(darshan, i)" (ionImgDidLoad)="image.isLoaded = true" (ionError)="image.isError = true" alt=""></ion-img>

        <div [hidden]="(image?.isDownloaded | async) || image?.isLoaded" class="parent">
          <div class="background">
              <ion-spinner *ngIf="!image?.isError || image?.isLoading" color="dark" name="crescent"></ion-spinner>
              <ion-icon *ngIf="image?.isError" (click)="downloadImage(image, i)"  class="download-icon" name="arrow-round-down"></ion-icon>
          </div>
          <img (click)="presentModal(darshan, i)" [src]="image?.placeholder" alt="placeholder" class="placeholder">
        </div>
      </ion-card>
      <!-- <span>error: {{image?.isError}}</span>
      <span>isDownloaded: {{image?.isDownloaded | async}}</span> -->
      <!-- <span>loaded: {{image?.isLoaded}}</span> -->
    </ion-item>
  </ion-list>
</ion-content>